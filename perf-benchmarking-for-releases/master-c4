+ set -e
+ echo '!!! Ensure your account has the following permissions:'
!!! Ensure your account has the following permissions:
+ echo 'Read access to:    gs://gcsfuse-release-benchmark-fio-data'
Read access to:    gs://gcsfuse-release-benchmark-fio-data
+ echo 'Read/Write access to: gs://gcsfuse-release-benchmarks-results'
Read/Write access to: gs://gcsfuse-release-benchmarks-results
+ GCSFUSE_VERSION=master
+ PROJECT_ID=gcs-fuse-test
+ REGION=us-south1
+ MACHINE_TYPE=c4-standard-96
+ IMAGE_FAMILY=ubuntu-2004-lts
+ IMAGE_PROJECT=ubuntu-os-cloud
++ date +%Y%m%d-%H%M%S
+ TIMESTAMP=20250529-044204
++ head /dev/urandom
++ tr -dc a-z0-9
++ head -c 8
+ RAND_SUFFIX=s19a9i4g
+ UNIQUE_ID=20250529-044204-s19a9i4g
+ VM_NAME=gcsfuse-perf-benchmark-ubuntu-2004-lts-20250529-044204-s19a9i4g
+ GCS_BUCKET_WITH_FIO_TEST_DATA=gcsfuse-release-benchmark-data-20250529-044204-s19a9i4g
+ RESULTS_BUCKET_NAME=gcsfuse-release-benchmarks-results
+ VM_ZONE=us-south1-a
+ echo 'Starting GCSFuse performance benchmarking for version: master'
Starting GCSFuse performance benchmarking for version: master
+ echo 'VM Name: gcsfuse-perf-benchmark-ubuntu-2004-lts-20250529-044204-s19a9i4g'
VM Name: gcsfuse-perf-benchmark-ubuntu-2004-lts-20250529-044204-s19a9i4g
+ echo 'Test Data Bucket: gs://gcsfuse-release-benchmark-data-20250529-044204-s19a9i4g'
Test Data Bucket: gs://gcsfuse-release-benchmark-data-20250529-044204-s19a9i4g
+ echo 'Results Bucket: gs://gcsfuse-release-benchmarks-results'
Results Bucket: gs://gcsfuse-release-benchmarks-results
+ echo 'Project ID: gcs-fuse-test'
Project ID: gcs-fuse-test
+ echo 'Region: us-south1'
Region: us-south1
+ echo 'VM Zone: us-south1-a'
VM Zone: us-south1-a
+ echo 'Machine Type: c4-standard-96'
Machine Type: c4-standard-96
+ LSSD_SUPPORTED_MACHINES=("n2-standard-96" "c2-standard-60" "c2d-standard-112" "c3-standard-88" "c3d-standard-180")
+ VM_LOCAL_SSD_ARGS=
+ LSSD_ENABLED=false
+ [[  n2-standard-96 c2-standard-60 c2d-standard-112 c3-standard-88 c3d-standard-180  =~  c4-standard-96  ]]
+ echo 'Machine type c4-standard-96 does not support LSSDs based on the configured list, or it'\''s not set up for LSSD benchmarking.'
Machine type c4-standard-96 does not support LSSDs based on the configured list, or it's not set up for LSSD benchmarking.
+ echo 'VM will be created without local SSDs.'
VM will be created without local SSDs.
+ trap cleanup EXIT
+ echo 'Creating GCS test data bucket: gs://gcsfuse-release-benchmark-data-20250529-044204-s19a9i4g in region: us-south1'
Creating GCS test data bucket: gs://gcsfuse-release-benchmark-data-20250529-044204-s19a9i4g in region: us-south1
+ gcloud storage buckets create gs://gcsfuse-release-benchmark-data-20250529-044204-s19a9i4g --project=gcs-fuse-test --location=us-south1
Creating gs://gcsfuse-release-benchmark-data-20250529-044204-s19a9i4g/...
+ echo 'Clearing previous data in gs://gcsfuse-release-benchmarks-results/master/c4-standard-96...'
Clearing previous data in gs://gcsfuse-release-benchmarks-results/master/c4-standard-96...
+ gcloud storage rm -r 'gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/**' --quiet
+ true
+ echo 'Uploading all .fio job files from local '\''fio-job-files/'\'' directory to gs://gcsfuse-release-benchmarks-results/master/fio-job-files/...'
Uploading all .fio job files from local 'fio-job-files/' directory to gs://gcsfuse-release-benchmarks-results/master/fio-job-files/...
+ gcloud storage cp fio-job-files/random-read-workload.fio fio-job-files/sequential-read-workload.fio fio-job-files/write-workload.fio gs://gcsfuse-release-benchmarks-results/master/fio-job-files/
Copying file://fio-job-files/random-read-workload.fio to gs://gcsfuse-release-benchmarks-results/master/fio-job-files/random-read-workload.fio
Copying file://fio-job-files/sequential-read-workload.fio to gs://gcsfuse-release-benchmarks-results/master/fio-job-files/sequential-read-workload.fio
  
Copying file://fio-job-files/write-workload.fio to gs://gcsfuse-release-benchmarks-results/master/fio-job-files/write-workload.fio
..

Average throughput: 100.5kiB/s
+ echo 'FIO job files uploaded.'
FIO job files uploaded.
++ gcloud projects describe gcs-fuse-test '--format=value(projectNumber)'
+ PROJECT_NUMBER=927584127901
+ STS_ACCOUNT=project-927584127901@storage-transfer-service.iam.gserviceaccount.com
+ gcloud storage buckets add-iam-policy-binding gs://gcsfuse-release-benchmark-data-20250529-044204-s19a9i4g --member=serviceAccount:project-927584127901@storage-transfer-service.iam.gserviceaccount.com --role=roles/storage.admin
bindings:
- members:
  - serviceAccount:project-927584127901@storage-transfer-service.iam.gserviceaccount.com
  role: roles/storage.admin
- members:
  - projectEditor:gcs-fuse-test
  - projectOwner:gcs-fuse-test
  role: roles/storage.legacyBucketOwner
- members:
  - projectViewer:gcs-fuse-test
  role: roles/storage.legacyBucketReader
- members:
  - projectEditor:gcs-fuse-test
  - projectOwner:gcs-fuse-test
  role: roles/storage.legacyObjectOwner
- members:
  - projectViewer:gcs-fuse-test
  role: roles/storage.legacyObjectReader
etag: CAI=
kind: storage#policy
resourceId: projects/_/buckets/gcsfuse-release-benchmark-data-20250529-044204-s19a9i4g
version: 1
+ echo 'Creating storage transfer job to copy read data to gs://gcsfuse-release-benchmark-data-20250529-044204-s19a9i4g...'
Creating storage transfer job to copy read data to gs://gcsfuse-release-benchmark-data-20250529-044204-s19a9i4g...
++ gcloud transfer jobs create gs://gcsfuse-release-benchmark-fio-data gs://gcsfuse-release-benchmark-data-20250529-044204-s19a9i4g --include-prefixes=read --project=gcs-fuse-test '--format=value(name)' --no-async
Created job: transferJobs/6150987267535120399
Polling for latest operation name...
.................done.
Latest Operation: transferOperations/transferJobs-6150987267535120399-40076063795906324
Waiting for operation to complete...
..................................................................................................................................................................................................................................................................................................................done.
+ TRANSFER_JOB_NAME=transferJobs/6150987267535120399
+ echo 'Transfer completed.'
Transfer completed.
+ echo 'Creating VM: gcsfuse-perf-benchmark-ubuntu-2004-lts-20250529-044204-s19a9i4g in zone us-south1-a...'
Creating VM: gcsfuse-perf-benchmark-ubuntu-2004-lts-20250529-044204-s19a9i4g in zone us-south1-a...
+ gcloud compute instances create gcsfuse-perf-benchmark-ubuntu-2004-lts-20250529-044204-s19a9i4g --project=gcs-fuse-test --image-family=ubuntu-2004-lts --machine-type=c4-standard-96 --image-project=ubuntu-os-cloud --zone=us-south1-a --boot-disk-size=1000GB --network-interface=network-tier=PREMIUM,nic-type=GVNIC --scopes=https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/devstorage.read_write --network-performance-configs=total-egress-bandwidth-tier=TIER_1 --metadata GCSFUSE_VERSION=master,MACHINE_TYPE=c4-standard-96,GCS_BUCKET_WITH_FIO_TEST_DATA=gcsfuse-release-benchmark-data-20250529-044204-s19a9i4g,RESULTS_BUCKET_NAME=gcsfuse-release-benchmarks-results,LSSD_ENABLED=false --metadata-from-file=startup-script=starter-script.sh
Created [https://www.googleapis.com/compute/v1/projects/gcs-fuse-test/zones/us-south1-a/instances/gcsfuse-perf-benchmark-ubuntu-2004-lts-20250529-044204-s19a9i4g].
WARNING: Some requests generated warnings:
 - Disk size: '1000 GB' is larger than image size: '10 GB'. You might need to resize the root repartition manually if the operating system does not support automatic resizing. See https://cloud.google.com/compute/docs/disks/add-persistent-disk#resize_pd for details.

NAME                                                             ZONE         MACHINE_TYPE    PREEMPTIBLE  INTERNAL_IP  EXTERNAL_IP     STATUS
gcsfuse-perf-benchmark-ubuntu-2004-lts-20250529-044204-s19a9i4g  us-south1-a  c4-standard-96               10.206.0.52  34.174.225.107  RUNNING
+ echo 'VM created. Benchmarks will run on the VM.'
VM created. Benchmarks will run on the VM.
+ echo 'Waiting for benchmarks to complete on VM (polling for success.txt)...'
Waiting for benchmarks to complete on VM (polling for success.txt)...
+ SUCCESS_FILE_PATH=gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/success.txt
+ LOG_FILE_PATH=gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/benchmark_run.log
+ SLEEP_TIME=300
+ sleep 300
+ MAX_RETRIES=18
+ (( i=1 ))
+ (( i<=MAX_RETRIES ))
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/success.txt
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/details.txt
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/benchmark_run.log
+ echo 'Attempt 1/18: success.txt not found. Sleeping for 5 minutes...'
Attempt 1/18: success.txt not found. Sleeping for 5 minutes...
+ sleep 300
+ (( i++ ))
+ (( i<=MAX_RETRIES ))
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/success.txt
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/details.txt
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/benchmark_run.log
+ echo 'Attempt 2/18: success.txt not found. Sleeping for 5 minutes...'
Attempt 2/18: success.txt not found. Sleeping for 5 minutes...
+ sleep 300
+ (( i++ ))
+ (( i<=MAX_RETRIES ))
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/success.txt
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/details.txt
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/benchmark_run.log
+ echo 'Attempt 3/18: success.txt not found. Sleeping for 5 minutes...'
Attempt 3/18: success.txt not found. Sleeping for 5 minutes...
+ sleep 300
+ (( i++ ))
+ (( i<=MAX_RETRIES ))
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/success.txt
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/details.txt
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/benchmark_run.log
+ echo 'Attempt 4/18: success.txt not found. Sleeping for 5 minutes...'
Attempt 4/18: success.txt not found. Sleeping for 5 minutes...
+ sleep 300
+ (( i++ ))
+ (( i<=MAX_RETRIES ))
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/success.txt
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/details.txt
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/benchmark_run.log
+ echo 'Attempt 5/18: success.txt not found. Sleeping for 5 minutes...'
Attempt 5/18: success.txt not found. Sleeping for 5 minutes...
+ sleep 300
+ (( i++ ))
+ (( i<=MAX_RETRIES ))
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/success.txt
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/details.txt
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/benchmark_run.log
+ echo 'Attempt 6/18: success.txt not found. Sleeping for 5 minutes...'
Attempt 6/18: success.txt not found. Sleeping for 5 minutes...
+ sleep 300
+ (( i++ ))
+ (( i<=MAX_RETRIES ))
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/success.txt
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/details.txt
+ gcloud storage objects describe gs://gcsfuse-release-benchmarks-results/master/c4-standard-96/benchmark_run.log
+ echo 'Attempt 7/18: success.txt not found. Sleeping for 5 minutes...'
Attempt 7/18: success.txt not found. Sleeping for 5 minutes...
+ sleep 300
