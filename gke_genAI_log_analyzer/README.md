# Log Detective üïµÔ∏è‚Äç‚ôÇÔ∏è

**Log Detective** is a CLI tool written in Go that automates the debugging of GCSFuse sidecar errors in Google Kubernetes Engine (GKE).

It scans Google Cloud Logging for errors, retrieves the surrounding log context (time-windowed), and sends the data to Google's Gemini (Vertex AI) to generate a root cause analysis report.

## ‚ú® Features

*   **Automated Log Scanning**: Finds the most recent GCSFuse error within a specified time window.
*   **Context Expansion**: Automatically fetches logs 2 minutes before and 1 minute after the error to provide context.
*   **AI Analysis**: Uses Gemini (Vertex AI) to analyze the log sequence and identify:
    *   The trigger of the error.
    *   Whether it is a permission, network, or configuration issue.
    *   If the model crashed due to the error.

## üõ†Ô∏è Prerequisites

1.  **Go**: Ensure you have Go installed (version 1.21+ recommended).
2.  **Google Cloud Project**: You need a GCP project with the following APIs enabled:
    *   Cloud Logging API
    *   Vertex AI API
3.  **Authentication**: Your environment must be authenticated.
    ```bash
    gcloud auth application-default login
    ```

## üì¶ Installation

1.  Clone this repository or navigate to the directory containing `main.go`.
2.  Initialize the module and download dependencies:

    ```bash
    go mod init gke_genAI-log_analyzer # If not already initialized
    go mod tidy
    ```

## üöÄ Usage

Run the tool using `go run main.go`. The `-project` flag is required.

### Basic Usage

Scan the last 1 hour (default) for errors in a specific project:

```bash
go run main.go -project <YOUR_PROJECT_ID>
```

### Specific Pod

Filter logs for a specific Pod name:

```bash
go run main.go -project <YOUR_PROJECT_ID> -pod <POD_NAME>
```

### Custom Time Window (Relative)

Look back 4 hours instead of the default 1 hour:

```bash
go run main.go -project <YOUR_PROJECT_ID> -lookback 4h
```

### Explicit Time Window

Search for errors within a specific RFC3339 time range:

```bash
go run main.go -project <YOUR_PROJECT_ID> \
  -start "2025-01-07T10:00:00Z" \
  -end "2025-01-07T11:00:00Z"
```

### Change Region

If your Vertex AI resources are in a different region (default is `us-central1`):

```bash
go run main.go -project <YOUR_PROJECT_ID> -region us-west1
```

## üìù Output

The tool will output a **Log Detective Report** generated by Gemini, summarizing the findings directly in your terminal.